---
layout: post
title: Swift) KVO
category: iOS
---
*Publishing Date:2020-09-21*

### 배경지식

### KVO
Key Value Observing
다른 객체에게 객체 프로퍼티의 변화를 알리는(`notify`) 프로그래밍 패턴
MVC 패턴과 같이 논리적으로 분리된 파트간 커뮤니케이션을 위해 사용
`NSObject`를 상속한 class에서만 사용 가능

### 적용
1. 프로퍼티 마킹  
`NSObject`를 상속한 클래스 안의 프로퍼티 중 KVO 패턴을 통해 Observe하고싶은 프로퍼티들에 `@objc dynamic` 키워드를 추가한다.
```Swift
class MyObjectToObserve: NSObject {
    @objc dynamic var myDate = NSDate(timeIntervalSince1970: 0) // 1970
    func updateDate() {
        myDate = myDate.addingTimeInterval(Double(2 << 30)) // Adds about 68 years.
    }
}
```

2. Observer 클래스 정의  
```Swift
class MyObserver: NSObject {
    @objc var objectToObserve: MyObjectToObserve
    var observation: NSKeyValueObservation?

    init(object: MyObjectToObserve) {
        objectToObserve = object
        super.init()

        observation = observe(
            \.objectToObserve.myDate,
            options: [.old, .new]
        ) { object, change in
            print("myDate changed from: \(change.oldValue!), updated to: \(change.newValue!)")
        }
    }
}
```

3. Observer와 마킹한 프로퍼티 링크  
```Swift
let observed = MyObjectToObserve()
let observer = MyObserver(object: observed)
```

4. 데이터 업데이트  
```Swift
observed.updateDate() // Triggers the observer's change handler.
// Prints "myDate changed from: 1970-01-01 00:00:00 +0000, updated to: 2038-01-19 03:14:08 +0000"
```




### Reference
[애플 개발자 문서](https://developer.apple.com/documentation/swift/cocoa_design_patterns/using_key-value_observing_in_swift)
